<!DOCTYPE html>
<html>
  <head>
    <title>Domains Service</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  </head>
  <body data-server-no-reload>
    <center style="width:800px; margin: 5rem auto; margin-bottom: 0rem;">
        <di class="row g-3">
            <div class="col-md-6">
                <h5 id="dominio"></h5>
            </div>
            <div class="col-md-6">
                <select class="form-select" id="selectDurata" required>
                    <option value="1" selected>1 Anno</option>
                    <option value="2">2 Anni</option>
                    <option value="3">3 Anni</option>
                    <option value="4">4 Anni</option>
                    <option value="5">5 Anni</option>
                    <option value="6">6 Anni</option>
                    <option value="7">7 Anni</option>
                    <option value="8">8 Anni</option>
                    <option value="9">9 Anni</option>
                    <option value="10">10 Anni</option>
                  </select>
            </div>
        </di>
    </center>
    <form style="width:800px; margin: 2rem auto;" id="form">
        <div class="mb-3">
          <label for="exampleInputEmail1" class="form-label">Email address</label>
          <input type="email" class="form-control" id="emailInput" aria-describedby="emailHelp" required>
        </div>
        <fieldset disabled>
            <div class="input-group">
                <span class="input-group-text">First and last name</span>
                <input type="text" aria-label="First name" class="form-control" id="nameInput">
                <input type="text" aria-label="Last name" class="form-control" id="surnameInput">
            </div>
        </fieldset>

        <div class="input-group mb-3" style="margin-top: 1rem;">
            <input type="text" class="form-control" placeholder="Numero carta di credito" required>
        </div>
          
        <div class="input-group mb-3">
            <input type="month" class="form-control" required>
            <span class="input-group-text">-</span>
            <input type="tel" class="form-control" placeholder="CVV" required maxlength="3">
        </div>
          
        <div class="input-group">
            <span class="input-group-text">Intestatario</span>
            <input id="cardName" type="text" aria-label="First name" class="form-control" required>
            <input id="cardSurname" type="text" aria-label="Last name" class="form-control" required>
        </div>
        
        <button id="rinnovaDominio" type="submit" class="btn btn-primary" style="margin-top: 1rem;">Rinnova dominio</button>
    </form>
    </body>
    <script src="script.js"></script>
    <script>
        window.onload = init();

        async function rinnovaDominio(){
            //Manda dominio con tutti i dati
            //Manda ordine da aggiungere con tipo rinnovo
        }

        async function ottieniNomeCognome(){
            let email = document.getElementById("emailInput").value;

            if(email){
                let response = await getUser(email);

                //Se è errore
                if (typeof response === 'string' || response instanceof String){
                    document.getElementById("erroreTxt").innerText = response;
                }else{
                    //Se è non errore
                    document.getElementById("nameInput").value = response["name"];
                    document.getElementById("surnameInput").value = response["surname"];
                    document.getElementById("cardName").value = response["name"];
                    document.getElementById("cardSurname").value = response["surname"];
                    document.getElementById("erroreTxt").innerText = "";
                }
            }
        }

        async function init() {
            document.getElementById('form')
            .addEventListener('submit', event => {
                event.preventDefault();
                
                rinnovaDominio();
            });

            document.getElementById("dominio").innerText = "Rinnova " + localStorage.getItem("domainName");

           
            document.getElementById("emailInput").value =  localStorage.getItem("email");

            await ottieniNomeCognome();
        }
    </script>
  </body>
</html>
